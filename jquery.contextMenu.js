// jQuery Context Menu Plugin
//
// Version 1.01
//
// Cory S.N. LaViska
// A Beautiful Site (http://abeautifulsite.net/)
//
// More info: http://abeautifulsite.net/2008/09/jquery-context-menu-plugin/
//
// Terms of Use
//
// This plugin is dual-licensed under the GNU General Public License
//   and the MIT License and is copyright A Beautiful Site, LLC.
//
// Modified by Philip Weir:
//   Added highlighting of selected row and submenu support
//   Added sub menu functions
//   Added bind to contextmenu event
//   Adjust menu position for screen boundaries
//   Shrunk with Google Closure Compiler (Simple Optimizations)
jQuery&&function(){$.extend($.fn,{contextMenu:function(a,e){if(void 0==a.menu)return!1;void 0==a.inSpeed&&(a.inSpeed=150);void 0==a.outSpeed&&(a.outSpeed=75);0==a.inSpeed&&(a.inSpeed=-1);0==a.outSpeed&&(a.outSpeed=-1);$(this).each(function(){var b=$(this),j=$(b).offset();$("#"+a.menu).addClass("contextMenu");$(this).mousedown(function(k){$(this).mouseup(function(f){var d=$(this);$(this).unbind("mouseup");if(k.button==2){$(".contextRow").removeClass("contextRow");$(".contextMenu").hide();d.addClass("contextRow");
rcm_update_options(d);var c=$("#"+a.menu);$(this).submenu_render(c);if($(b).hasClass("disabled"))return false;var g,h;f.pageX?g=f.pageX:g=f.clientX+void 0;f.pageY?h=f.pageY:h=f.clientY+void 0;g+$(c).width()+10>$(document).width()&&$(document).width()-$(c).width()-10>0&&(g=$(document).width()-$(c).width()-10);h+$(c).height()+10>$(document).height()&&$(document).height()-$(c).height()-10>0&&(h=$(document).height()-$(c).height()-10);$(document).unbind("click");$("#"+a.menu+" li ul").hide();$("#"+a.menu+
" li div").hide();$(c).css({top:h,left:g}).fadeIn(a.inSpeed);$(c).find("A").mouseover(function(){$(c).find("LI.hover").removeClass("hover");$(this).parent().addClass("hover")}).mouseout(function(){$(c).find("LI.hover").removeClass("hover")});$(document).keypress(function(a){switch(a.keyCode){case 38:if($(c).find("LI.hover").size()==0)$(c).find("LI:last").addClass("hover");else{$(c).find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover");$(c).find("LI.hover").size()==
0&&$(c).find("LI:last").addClass("hover")}break;case 40:if($(c).find("LI.hover").size()==0)$(c).find("LI:first").addClass("hover");else{$(c).find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover");$(c).find("LI.hover").size()==0&&$(c).find("LI:first").addClass("hover")}break;case 13:$(c).find("LI.hover A").trigger("click");break;case 27:$(document).trigger("click")}});$("#"+a.menu).find("A").unbind("click");$("#"+a.menu).find("LI A:not(.disabled)").click(function(){$(document).unbind("click").unbind("keypress");
$(".contextMenu").hide();d.removeClass("contextRow");e&&e($(this).attr("href").substr(1),$(d),{x:g-j.left,y:h-j.top,docX:g,docY:h});return false});setTimeout(function(){$(document).click(function(){$(document).unbind("click").unbind("keypress");$(".contextRow").removeClass("contextRow");$(c).fadeOut(a.outSpeed);return false});$("iframe").load(function(){(this.contentDocument?this.contentDocument:this.contentWindow?this.contentWindow.document:null).onclick=function(){$(document).click()}});$("iframe").contents().mouseup(function(){$(document).click()})},
0)}if(!rcmail.drag_active){f.cancelBubble=true;f.stopPropagation&&f.stopPropagation()}})});var d,i;$("#"+a.menu).children("li").mouseenter(function(){if($(this).hasClass("submenu")){if($(this).hasClass("submenu")&&!d&&!$(this).children("*:not(a, span)").is(":visible")){window.clearTimeout(i);i=null;var b=this;d=window.setTimeout(function(){$("#"+a.menu).children("li.submenu").children("div.popupmenu").children("ul.scrollable").scrollTop(0);$("#"+a.menu).children("li.submenu").children("div.popupmenu").children("div.scroll_up_act").addClass("scroll_up_pas").removeClass("scroll_up_act");
$("#"+a.menu).children("li.submenu").children("div.popupmenu").children("div.scroll_down_pas").addClass("scroll_down_act").removeClass("scroll_down_pas");$("#"+a.menu).children("li.submenu").children("*:not(a, span)").hide();doc_height=$(document).height();$(b).children("*:not(a, span)").css({left:$("#"+a.menu).width()-2,top:0});$(b).children("*:not(a, span)").show();$(b).children("*:not(a, span)").offset().left+$(b).children("*:not(a, span)").width()+10>$(document).width()&&$(document).width()-$(b).children("*:not(a, span)").width()-
$("#"+a.menu).width()>0&&$(b).children("*:not(a, span)").css({left:$(b).children("*:not(a, span)").width()*-1});y=($(b).children("*:not(a, span)").offset().top+$(b).children("*:not(a, span)").height()+10-doc_height)*-1;y<0&&$(b).children("*:not(a, span)").offset().top+y>0&&$(b).children("*:not(a, span)").css({top:y});$(b).children("div.popupmenu").length&&$(b).children("div.popupmenu").children().show();d=null},a.submenu_delay)}}else i=window.setTimeout(function(){$("#"+a.menu).children("li.submenu").children("*:not(a, span)").hide();
i=null},a.submenu_delay)});$("#"+a.menu).children("li.submenu").mouseleave(function(){window.clearTimeout(d);d=null});$(this).mouseleave(function(){window.clearTimeout(d);d=null});$.browser.mozilla?$("#"+a.menu).each(function(){$(this).css({MozUserSelect:"none"})}):$.browser.msie?$("#"+a.menu).each(function(){$(this).bind("selectstart.disableTextSelect",function(){return false})}):$("#"+a.menu).each(function(){$(this).bind("mousedown.disableTextSelect",function(){return false})});$(b).add($("UL.contextMenu")).bind("contextmenu",
function(){return false})});return $(this)},disableContextMenuItems:function(a){if(void 0==a)return $(this).find("a").addClass("disabled"),$(this);$(this).each(function(){if(void 0!=a)for(var e=a.split(","),b=0;b<e.length;b++)$(this).find('A[href="'+e[b]+'"]').addClass("disabled")});return $(this)},enableContextMenuItems:function(a){if(void 0==a)return $(this).find("a.disabled").removeClass("disabled"),$(this);$(this).each(function(){if(void 0!=a)for(var e=a.split(","),b=0;b<e.length;b++)$(this).find('A[href="'+
e[b]+'"]').removeClass("disabled")});return $(this)},disableContextMenu:function(){$(this).each(function(){$(this).addClass("disabled")});return $(this)},enableContextMenu:function(){$(this).each(function(){$(this).removeClass("disabled")});return $(this)},destroyContextMenu:function(){$(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")});return $(this)},submenu_render:function(a){$(a).show();$(a).children("li.submenu").children().show();$(a).children("li.submenu").children("div.popupmenu").each(function(){ul_overflow=
$(this).children("ul").css("overflow");$(this).children("ul").css({overflow:"visible"});$(this).children("div").css({width:$(this).children("ul").width()+"px"});$(this).css({width:$(this).children("ul").width()+"px"});$(this).children("ul").css({overflow:ul_overflow});$(this).children("div").click(function(a){var b=$(this).parent().children("ul");$(this).hasClass("scroll_up_act")?($(b).scrollTop($(b).scrollTop()-18),$(this).parent().children("div.scroll_down_pas").addClass("scroll_down_act"),$(this).parent().children("div.scroll_down_pas").removeClass("scroll_down_pas"),
0==$(b).scrollTop()&&($(this).removeClass("scroll_up_act"),$(this).addClass("scroll_up_pas"))):$(this).hasClass("scroll_down_act")&&($(b).scrollTop($(b).scrollTop()+18),$(this).parent().children("div.scroll_up_pas").addClass("scroll_up_act"),$(this).parent().children("div.scroll_up_pas").removeClass("scroll_up_pas"),$(b).prop("scrollHeight")-$(b).scrollTop()==$(b).outerHeight()&&($(this).removeClass("scroll_down_act"),$(this).addClass("scroll_down_pas")));a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()});
$(this).children("ul").mousewheel($(this).submenu_mousewheel)});$(a).children("li.submenu").children("*:not(a, span)").hide();$(a).hide()},submenu_mousewheel:function(a,e){0<e?$(this).parent().children("div.scroll_up_act").click():0>e&&$(this).parent().children("div.scroll_down_act").click()}})}(jQuery);
